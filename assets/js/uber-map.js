!function(a,b){var c=function(a,b,c){var d;return function(){function e(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(e,b||100)}};jQuery.fn[b]=function(a){return a?this.bind("resize",c(a)):this.trigger(b)}}(jQuery,"smartresize"),$(function(){var a=$(".scroller"),b=$(".nav-bar"),c=$(".map-footer"),d=function(){var d=$(window).height()-b.outerHeight()-c.outerHeight();a.css("height",d+"px")};d(),$(window).smartresize(function(){d()});var e=Cesium.Color.YELLOW,f=new Cesium.Color(1,.5,0,1),g=0,h=9999999,i=5e3,a=$(".left-panel .scroller");ko=Cesium.knockout,Cesium.BingMapsApi.defaultKey="AgRxdroanFbgogMNQ3HpvADZ2txGKmu1cTTRqlrAUSFLfbP38ZhuYKBSY1ZK0aHl";var j=new Cesium.Viewer("cesiumContainer",{animation:!1,homeButton:!1,timeline:!1,sceneModePicker:!1,baseLayerPicker:!1,fullscreenButton:!1,navigationHelpButton:!1,geocoder:!1,infoBox:!1,terrainProvider:new Cesium.CesiumTerrainProvider({url:"//cesiumjs.org/stk-terrain/tilesets/world/tiles",credit:'Routes plotted by <a href="http://erikhenne.com">Erik Henne</a>'})});j.extend(Cesium.viewerEntityMixin);var k=j.scene,l=(k.primitives,k.camera);Cesium.knockout.getObservable(j,"selectedEntity").subscribe(function(a){void 0!==a&&$("#"+a.id).trigger("click")});var m=new Cesium.GeoJsonDataSource;m.loadUrl("/assets/gpx/ski-tours-complete.geojson").then(function(){m.entities.entities;n()}).otherwise(function(){alert("Tours could not be found. Please reload the page.")}),j.dataSources.add(m),l.lookAt(Cesium.Cartesian3.fromDegrees(-121.81263,44,2e5),Cesium.Cartesian3.fromDegrees(-121.81263,48.706652,0),Cesium.Cartesian3.UNIT_Z);var n=function(){function b(a){this.id=ko.observable(a.id),this.name=ko.observable(a.name),this.description=ko.observable(a.description),this.distance=ko.observable(a.distance),this.link=ko.observable(a.link),this.formattedDistance=ko.computed(function(){return this.distance()?this.distance()+"mi":void 0},this)}function c(){var c=this;c.tours=ko.observableArray([]),c.query=ko.observable(""),c.minDistanceQuery=ko.observable(""),c.maxDistanceQuery=ko.observable(""),c.filteredTours=ko.computed(function(){var a=this.query().toLowerCase(),b=this.minDistanceQuery()||g,c=this.maxDistanceQuery()||h;return a||b!=g||c!=h?ko.utils.arrayFilter(this.tours(),function(d){return a?-1!==d.name().toLowerCase().indexOf(a)&&d.distance()>=b&&d.distance()<=c:d.distance()>=b&&d.distance()<=c}):this.tours()},c),c.tourMouseOver=function(){},c.tourMouseOut=function(){},c.tourClick=function(b,c){var d=m.entities.getById(c.id()),g=$("#"+c.id()),h=g.position().top;(h>a.scrollTop()+a.height()||h<a.scrollTop())&&a.animate({scrollTop:h},2e3),g.addClass("selected").siblings().removeClass("selected");for(var j=m.entities.entities,k=0;k<j.length;k++){var n=j[k];n.polyline&&(n.polyline.material=Cesium.ColorMaterialProperty.fromColor(e)),n.polygon&&(n.polygon.material=Cesium.ColorMaterialProperty.fromColor(e))}if(d.polyline){var o=d.polyline.positions.getValue(new Cesium.JulianDate.now);d.polyline.material=Cesium.ColorMaterialProperty.fromColor(f)}else{var o=d.polygon.positions.getValue(new Cesium.JulianDate.now);d.polygon.material=Cesium.ColorMaterialProperty.fromColor(f)}o=Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(o);for(var p,q,r=Cesium.Rectangle.fromCartographicArray(o),s=Cesium.Rectangle.center(r),k=0;k<o.length;k++){var t=o[k];("undefined"==typeof p||t.height>p)&&(p=t.height),("undefined"==typeof q||t.height<q)&&(q=t.height)}s.height=(p+q)/2+i;var u=Cesium.Ellipsoid.WGS84.cartographicToCartesian(s);return l.flyTo({destination:u}),!0};var d=$.map(m.entities.entities,function(a){return new b({id:a.id,name:a.name,description:a.properties.description,distance:a.properties.distance,link:a.properties.link})});c.tours(d),c.filteredTours.subscribe(function(a){for(var b=m.entities.entities,c=0;c<b.length;c++){var d=b[c];d.polyline&&(d.polyline.show=new Cesium.ConstantProperty(!1)),d.polygon&&(d.polygon.show=new Cesium.ConstantProperty(!1))}$.each(a,function(){var a=this,b=m.entities.getById(a.id());b.polyline&&(b.polyline.show=new Cesium.ConstantProperty(!0)),b.polygon&&(b.polygon.show=new Cesium.ConstantProperty(!0))})})}$(".left-panel").removeClass("loading"),ko.applyBindings(new c,document.getElementById("tour-filter-form"))}});