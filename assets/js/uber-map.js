!function(a,b){var c=function(a,b,c){var d;return function(){function e(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(e,b||100)}};jQuery.fn[b]=function(a){return a?this.bind("resize",c(a)):this.trigger(b)}}(jQuery,"smartresize"),$(function(){var a=$(".scroller"),b=$(".nav-bar"),c=$(".map-footer"),d=function(){var d=$(window).height()-b.outerHeight()-c.outerHeight();a.css("height",d+"px")};d(),$(window).smartresize(function(){d()});var e=Cesium.Color.YELLOW,f=new Cesium.Color(1,.5,0,1),g=0,h=9999999,a=$(".left-panel .scroller");ko=Cesium.knockout,Cesium.BingMapsApi.defaultKey="AgRxdroanFbgogMNQ3HpvADZ2txGKmu1cTTRqlrAUSFLfbP38ZhuYKBSY1ZK0aHl";var i=new Cesium.Viewer("cesiumContainer",{animation:!1,homeButton:!1,timeline:!1,sceneModePicker:!1,baseLayerPicker:!1,fullscreenButton:!1,navigationHelpButton:!1,geocoder:!1,infoBox:!1,terrainProvider:new Cesium.CesiumTerrainProvider({url:"//cesiumjs.org/stk-terrain/tilesets/world/tiles",credit:'Routes plotted by <a href="http://erikhenne.com">Erik Henne</a>'})});i.extend(Cesium.viewerEntityMixin);var j=(i.scene.primitives,i.scene.camera);Cesium.knockout.getObservable(i,"selectedEntity").subscribe(function(a){void 0!==a&&$("#"+a.id).trigger("click")});var k=new Cesium.GeoJsonDataSource;k.loadUrl("/assets/gpx/ski-tours-complete.geojson").then(function(){k.entities.entities;l()}).otherwise(function(){alert("Tours could not be found. Please reload the page.")}),i.dataSources.add(k),j.lookAt(Cesium.Cartesian3.fromDegrees(-121.81263,45,3e5),Cesium.Cartesian3.fromDegrees(-121.81263,48.706652,0),Cesium.Cartesian3.UNIT_Z);var l=function(){function b(a){this.id=ko.observable(a.id),this.name=ko.observable(a.name),this.description=ko.observable(a.description),this.distance=ko.observable(a.distance),this.formattedDistance=ko.computed(function(){return this.distance()?this.distance()+"mi":void 0},this)}function c(){var c=this;c.tours=ko.observableArray([]),c.query=ko.observable(""),c.minDistanceQuery=ko.observable(""),c.maxDistanceQuery=ko.observable(""),c.filteredTours=ko.computed(function(){var a=this.query().toLowerCase(),b=this.minDistanceQuery()||g,c=this.maxDistanceQuery()||h;return a||b!=g||c!=h?ko.utils.arrayFilter(this.tours(),function(d){return a?-1!==d.name().toLowerCase().indexOf(a)&&d.distance()>=b&&d.distance()<=c:d.distance()>=b&&d.distance()<=c}):this.tours()},c),c.tourMouseOver=function(){},c.tourMouseOut=function(){},c.tourClick=function(b,c){var d=k.entities.getById(c.id()),g=$("#"+c.id()),h=g.position().top;(h>a.scrollTop()+a.height()||h<a.scrollTop())&&a.animate({scrollTop:h},2e3),g.addClass("selected").siblings().removeClass("selected");for(var i=k.entities.entities,l=0;l<i.length;l++){var m=i[l];m.polyline&&(m.polyline.material=Cesium.ColorMaterialProperty.fromColor(e)),m.polygon&&(m.polygon.material=Cesium.ColorMaterialProperty.fromColor(e))}if(d.polyline){var n=d.polyline.positions.getValue(new Cesium.JulianDate.now);d.polyline.material=Cesium.ColorMaterialProperty.fromColor(f)}else{var n=d.polygon.positions.getValue(new Cesium.JulianDate.now);d.polygon.material=Cesium.ColorMaterialProperty.fromColor(f)}n=Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(n);for(var o,p,q,r,l=0;l<n.length;l++){var s=n[l];("undefined"==typeof o||s.longitude<o)&&(o=s.longitude),("undefined"==typeof p||s.latitude<p)&&(p=s.latitude),("undefined"==typeof q||s.longitude>q)&&(q=s.longitude),("undefined"==typeof r||s.latitude>r)&&(r=s.latitude)}j.flyToRectangle({destination:new Cesium.Rectangle(o,p,q,r),complete:function(){j.zoomOut(8e3)}})};var d=$.map(k.entities.entities,function(a){return new b({id:a.id,name:a.name,description:a.properties.description,distance:a.properties.distance})});c.tours(d),c.filteredTours.subscribe(function(a){for(var b=k.entities.entities,c=0;c<b.length;c++){var d=b[c];d.polyline&&(d.polyline.show=new Cesium.ConstantProperty(!1)),d.polygon&&(d.polygon.show=new Cesium.ConstantProperty(!1))}$.each(a,function(){var a=this,b=k.entities.getById(a.id());b.polyline&&(b.polyline.show=new Cesium.ConstantProperty(!0)),b.polygon&&(b.polygon.show=new Cesium.ConstantProperty(!0))})})}$(".left-panel").removeClass("loading"),ko.applyBindings(new c,document.getElementById("tour-filter-form"))}});